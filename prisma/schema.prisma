generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  username     String        @unique
  password     String
  isAdmin      Boolean       @default(false)
  createdAt    DateTime      @default(now())
  launchPoints LaunchPoint[]
}

model Point {
  id        Int                  @id @default(autoincrement())
  name      String
  latitude  Float
  longitude Float
  launchPoint LaunchPoint?
  publicTransportPoint PublicTransportPoint?
}

model LaunchPoint {
  id             Int                      @id @default(autoincrement())
  point          Point                    @relation(fields: [pointId], references: [id], onDelete: Cascade)
  pointId        Int                      @unique
  isOfficial     Boolean                  @default(false)
  hints          String?
  openingHours   String                   @default("24h")
  parkingOptions String?
  nearbyWaters   String?
  foodSupply     String?
  createdAt      DateTime                 @default(now())
  createdBy      User                     @relation(fields: [createdById], references: [id])
  createdById    Int
  categories     LaunchPointCategory[]
  stations       PublicTransportStation[]
}

enum PublicTransportType {
  train
  tram
  sbahn
  ubahn
}

model PublicTransportPoint {
  id        Int                          @id @default(autoincrement())
  point     Point                        @relation(fields: [pointId], references: [id], onDelete: Cascade)
  pointId   Int                          @unique
  lines     String?
  createdAt DateTime                     @default(now())
  types     PublicTransportPointType[]
}

model PublicTransportPointType {
  id                      Int                  @id @default(autoincrement())
  publicTransportPoint    PublicTransportPoint @relation(fields: [publicTransportPointId], references: [id], onDelete: Cascade)
  publicTransportPointId  Int
  type                    PublicTransportType

  @@unique([publicTransportPointId, type])
}

model Category {
  id                Int                  @id @default(autoincrement())
  name_en            String               @unique
  name_de            String
  launchPoints       LaunchPointCategory[]
}

model LaunchPointCategory {
  id            Int         @id @default(autoincrement())
  launchPoint   LaunchPoint @relation(fields: [launchPointId], references: [id], onDelete: Cascade)
  launchPointId Int
  category      Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId    Int

  @@unique([launchPointId, categoryId])
}

model PublicTransportStation {
  id             Int         @id @default(autoincrement())
  name           String
  distanceMeters Int
  launchPoint    LaunchPoint @relation(fields: [launchPointId], references: [id], onDelete: Cascade)
  launchPointId  Int
}
